var Queue=Queue||{};!function(a){Queue={add:function(){return a.post({url:ajaxurl,data:{action:"add_queue"}})},"delete":function(b){return a.post({url:ajaxurl,data:{action:"delete_queue",data:{queue_id:b}}})},disable:function(b){return a.post({url:ajaxurl,data:{action:"disable_queue",data:{queue_id:b}}})},is_empty:function(b){return a.post({url:ajaxurl,data:{action:"is_empty_queue",data:{queue_id:b}}})},get_all_elements:function(b){return a.post({url:ajaxurl,data:{action:"get_all_elements",data:{queue_id:b}}})},insert_element:function(b){return a.post({url:ajaxurl,data:{action:"insert_element",data:{name:b.name,queue_id:b.queue_id,data:b.data,type:b.type,priority:b.priority}}})},edit_element:function(b){return a.post({url:ajaxurl,data:{action:"edit_element",data:{id:b.id,name:b.name,queue_id:b.queue_id,data:b.data,type:b.type,priority:b.priority}}})},delete_element:function(b){return a.post({url:ajaxurl,data:{action:"delete_element",data:{element_id:b.id}}})},peek:function(b){return a.post({url:ajaxurl,data:{action:"peek_element",data:{queue_id:b.queue_id}}})},pop:function(b){return a.post({url:ajaxurl,data:{action:"pop_element",data:{queue_id:b.queue_id}}})}}}(jQuery);var Events=Events||{};!function(a,b){Events={attach_handlers:function(){var c=this;a(document.body).on("click","#add-queue",function(d){d.preventDefault(),b.add().done(function(b){200==b.status?(a("#queues").append('<option value="'+b.queue.id+'">Queue #'+b.queue.id+"</option>"),c.notice(b.message,"notice-success")):c.notice(b.message,"notice-warning")}).fail(function(){c.notice("Something went wrong","notice-error")})}),a(document.body).on("click","#delete-queue",function(d){d.preventDefault();var e=a("#queues option:selected").val();"0"!==e?b["delete"](e).done(function(b){200==b.status?(a("#queues option[value='"+b.queue.id+"']").remove(),c.notice(b.message,"notice-success")):c.notice(b.message,"notice-warning")}).fail(function(a){c.notice("Something went wrong","notice-error")}):c.notice("Select a queue from the list first.","notice-warning")}),a(document.body).on("click","#disable-queue",function(d){d.preventDefault();var e=a("#queues option:selected").val();"0"!==e?b.disable(e).done(function(b){200==b.status?(a("#queues option[value='"+b.queue.id+"']").remove(),c.notice(b.message,"notice-success")):c.notice(b.message,"notice-warning")}).fail(function(a){c.notice("Something went wrong","notice-error")}):c.notice("Select a queue from the list first.","notice-warning")}),a(document.body).on("click","#is-empty-queue",function(d){d.preventDefault();var e=a("#queues option:selected").val();"0"!==e?b.is_empty(e).done(function(a){200==a.status?c.notice(a.message,"notice-success"):c.notice(a.message,"notice-warning")}).fail(function(a){c.notice("Something went wrong","notice-error")}):c.notice("Select a queue from the list first.","notice-warning")}),a(document.body).on("click","#queue_elements > option",function(b){b.preventDefault(),a("#edit-element").prop("disabled",!1),a("#delete-element").prop("disabled",!1);var d=JSON.parse(decodeURI(this.dataset.serialized));c.populate_element(d)}),a(document.body).on("change","#queues",function(d){d.preventDefault();var e=a("#queues option:selected").val(),f=a("#queue_elements");"0"!==e?b.get_all_elements(e).done(function(a){if(200==a.status){c.notice(a.message,"notice-success");var b=JSON.parse(a.queue.elements);f.empty();for(var d=0;d<b.length;d++){var e=b[d].id,g=b[d].name;f.append('<option value="'+e+'" data-serialized="'+encodeURI(JSON.stringify(b[d]))+'">#'+e+" - "+g+"</option>")}}else c.notice(a.message,"notice-warning"),f.empty()}).fail(function(a){c.notice("Something went wrong","notice-error")}):a("#queue_elements").empty()}),a(document.body).on("change","#element_types",function(b){switch(b.preventDefault(),this.value){case"1":a('textarea[name="element_data[script]"]').removeClass("hidden").addClass("current-element");break;default:a(".current-element").addClass("hidden").removeClass("current-element")}}),a(document.body).on("click","#insert-element",function(d){d.preventDefault();var e={};e.name=a("#element_name").val(),e.queue_id=a("#queues option:selected").val(),e.type=a("#element_types option:selected").text().toLowerCase(),e.priority=a("#element_priority").val(),e.data=a('[name="element_data['+e.type+']"]').val(),"0"!==e.queue_id?b.insert_element(e).done(function(b){200==b.status?(c.notice(b.message,"notice-success"),a("#queues").trigger("change")):c.notice(b.message,"notice-warning")}).fail(function(a){c.notice("Something went wrong","notice-error")}):c.notice("Select a queue from the list first.","notice-warning")}),a(document.body).on("click","#edit-element",function(d){d.preventDefault();var e={};e.id=a("#element_id").val(),e.name=a("#element_name").val(),e.queue_id=a("#queues option:selected").val(),e.type=a("#element_types option:selected").text().toLowerCase(),e.priority=a("#element_priority").val(),e.data=a('[name="element_data['+e.type+']"]').val(),"0"!==e.queue_id?b.edit_element(e).done(function(b){200==b.status?(c.notice(b.message,"notice-success"),a("#queues").trigger("change")):c.notice(b.message,"notice-warning")}).fail(function(a){c.notice("Something went wrong","notice-error")}):c.notice("Select a queue from the list first.","notice-warning")}),a(document.body).on("click","#delete-element",function(d){d.preventDefault();var e={};e.id=a("#element_id").val(),e.queue_id=a("#queues option:selected").val(),"0"!==e.queue_id?b.delete_element(e).done(function(b){200==b.status?(c.notice(b.message,"notice-success"),a("#queues").trigger("change")):c.notice(b.message,"notice-warning")}).fail(function(a){c.notice("Something went wrong","notice-error")}):c.notice("Select a queue from the list first.","notice-warning")}),a(document.body).on("click","#peek-element",function(d){d.preventDefault();var e={};e.queue_id=a("#queues option:selected").val(),"0"!==e.queue_id?b.peek(e).done(function(a){200==a.status?(c.notice(a.message,"notice-success"),c.populate_element(JSON.parse(a.queue.element))):c.notice(a.message,"notice-warning")}).fail(function(a){c.notice(response.message,"notice-error")}):c.notice("Select a queue from the list first.","notice-warning")}),a(document.body).on("click","#pop-element",function(d){d.preventDefault();var e={};e.queue_id=a("#queues option:selected").val(),"0"!==e.queue_id?b.pop(e).done(function(a){200==a.status?(c.notice(a.message,"notice-success"),c.populate_element(JSON.parse(a.queue.element))):c.notice(a.message,"notice-warning")}).fail(function(a){c.notice(response.message,"notice-error")}):c.notice("Select a queue from the list first.","notice-warning")})},populate_element:function(b){a("#element_id").val(b.id),a("#element_name").val(b.name),a("#element_priority").val(b.priority),a('textarea[name="element_data['+b.type+']"]').val(b.data),a("#element_types > option").each(function(){a(this).text().toLowerCase()==b.type&&(a(this).attr("selected","selected"),a(this).parent().trigger("change"))})},notice:function(b,c){var d=a(".queue-notice");d.removeClass().addClass("queue-notice notice is-dismissible").html("<p></p>"),d.html("<p>"+b+"</p>").addClass(c)}},Events.attach_handlers()}(jQuery,Queue);